{% extends 'base.html' %}
{% load comments %}
{% load thumbnail %}

{% block title %}{{ object.name }}{% endblock %}

{% block content %}

    <div class="title-space">
        <p class="object-kind">{{ object.kind.name }}</p>
        <h1>{{ object.name }}</h1>

        {% if object.organisation %}
        <p>part of <a href="{{ object.organisation.get_absolute_url }}">{{ object.organisation.name }}</a></p>
        {% endif %}
    </div>
    
    <div class="profile-pic">
        {% if object.mapit_id %}

            <script src="{{ STATIC_URL }}js/map.js?{{ settings.STATIC_GENERATION_NUMBER }}"></script>

            <div id="map_canvas"></div>
            <script type="text/javascript" charset="utf-8">
                add_kml_to_map( '{{ settings.MAPIT_URL }}/area/{{ object.mapit_id }}.kml?simplify_tolerance=0.001' );            
            </script>
        {% else %}
            <div class="profile-pic">
                {% thumbnail object.primary_image "200x200" as im %}
                <img src="{{ im.url }}" alt="{{ object.name }}" width="{{ im.width }}" height="{{ im.height }}" />
                {% empty %}
                <img src="{{STATIC_URL}}images/place-200x200.jpg" />
                {% endthumbnail %}        
            </div>        
        {% endif %}
    </div>

    <div class="social-and-tools">
        <div class="fb-like" data-send="false" data-layout="button_count" data-width="95" data-show-faces="false"></div>
        
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="mysociety">Tweet</a>

        <ul class="tools">
            <li><a href="{% get_comment_add_url object %}" class="big-btn-text-green">Post Comment</a></li>
            <li><a href="{% url feedback_add %}?url={{ request.build_absolute_uri }}" class="feedback_link big-btn-text-red">Correct this information</a></li>
        </ul>
    </div>

    <div class="small-container">
        {% include 'scorecards/scorecard.html' %}
    </div>

    <div class="profile-info">
        {% with mp_pos=object.current_mp_position %}
        {% if mp_pos %}
        <div class="constituency-party">
            <h3>Key figure</h3>
            <ul>
                <li><a href="{{ mp_pos.person.get_absolute_url }}">{{ mp_pos.person.name }} <span>[mp]</span></a></li>
            </ul>
        </div>
        {% endif %}
        {% endwith %}
        
    </div>

    <div class="large-container">
        <div class="tab-wrapper">

            {% if object.summary %}
                <h2 class="tab-nav" rel="#overview"><a href="/">Overview</a></h2>
                <div class="tab markdown" id="overview">
                    {{ object.summary }}
                </div>
            {% endif %}

            <h2 class="tab-nav" rel="#related-people"><a href="/">Related People</a></h2>
            <div class="tab" id="related-people" data-tab-content-source-url="{% url place_related_person_tab slug=object.slug %}">
            </div>

	    {% comment %}
	    <!-- Not showing organisations for the moment as the list isn't very good. -->
            <h2 class="tab-nav" rel="#related-organisations"><a href="/">Related Organisations</a></h2>
            <div class="tab" id="related-organisations" data-tab-content-source-url="{% url place_related_organisation_tab slug=object.slug %}">
            </div>
	    {% endcomment %}

            {% include 'comments/detail_page_comments.html' %}
        </div>
    </div>


























    {% comment %}


    {% if object.parent_place %}
        <ul class="location_breadcrumb">
        {% for parent in object.parent_places %}
            <li><a href="{% url place slug=parent.slug %}">{{ parent.name }}</a></li>
        {% endfor %}
            <li>{{ object.name }}</li>
        </ul>
    {% endif %}
    
    

    <h1>{{ object.name }}</h1>

    {% if object.organisation %}
    <p>part of <a href="{{ object.organisation.get_absolute_url }}">{{ object.organisation.name }}</a></p>
    {% endif %}

    {% if object.mapit_id %}
    
        <div class="content_box">
    
            <div id="map_canvas" style="width:50%; min-width: 240px; height:300px"></div>
            
            <script type="text/javascript" charset="utf-8">
                add_kml_to_map( '{{ settings.MAPIT_URL }}/area/{{ object.mapit_id }}.kml?simplify_tolerance=0.001' );            
            </script>

        </div>

    {% endif %}
    

    {% if object.child_places.count %}        
        <div class="content_box">
            <h3>Areas within {{ object.name }}</h3>
            
            <ul class="listing">
            {% for child in object.child_places.all %}
                <li>
                    <a href="{{ child.get_absolute_url }}">{{ child.name }}</a>
                </li>
            {% empty %}
                <li>No child places</li>
            {% endfor %}
            </ul>            
        </div>
    {% endif %}


    {% with mp_pos=object.current_mp_position %}
        {% if mp_pos %}
            <div class="content_box">
                <h3>{{ mp_pos.person.name }}</h3>
        
                <p>
                    <a href="{{mp_pos.person.get_absolute_url }}">{{ mp_pos.person.name }}</a>
                    is the MP for {{ object.name }}
                    {% if mp_pos.start_date %}
                        (started {{ mp_pos.start_date }})
                    {% endif %}
                </p>
        
            </div>
        {% endif %}
    {% endwith %}

    {% include "projects/place_summary.html" %}

    {% endcomment %}

{% endblock %}
